<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Promise 实现(基础版)</title>
</head>

<body>
  <script>
    window.onload = () => {
      class MyPromise {
        #status = 'pending'
        #result = undefined
        #asyncResolveList = []
        #asyncRejectList = []
        constructor(executor) {
          const resolve = result => {
            this.#status = 'fulfilled'
            this.#result = result
            this.#asyncResolveList.forEach(fn => fn(this.#result))
          }
          const reject = result => {
            this.#status = 'rejected'
            this.#result = result
            this.#asyncRejectList.forEach(fn => fn(this.#result))
          }
          try {
            executor(resolve, reject)
          } catch (error) {
            reject(error)
          }
        }
        then(resolve, reject) {
          if (this.#status === 'fulfilled') {
            resolve(this.#result)
          }
          if (this.#status === 'rejected') {
            reject(this.#result)
          }
          if (this.#status === 'pending') {
            this.#asyncResolveList.push(resolve)
            this.#asyncRejectList.push(reject)
          }
        }
      }

      new MyPromise((resolve) => {
        console.log('create promise')
        setTimeout(() => {
          resolve('end')
        }, 1000)
      }).then((res) => {
        console.log(res)
      })
    }
  </script>
</body>

</html>